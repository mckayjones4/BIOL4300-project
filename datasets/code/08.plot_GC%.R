############################################################
# HHV-6B U90 Continuous Trait Mapping (GC%)
# ----------------------------------------------------------
#   This script visualizes GC% content as a continuous trait
#   mapped onto a Maximum Likelihood (ML) phylogenetic tree.
#   It uses the phytools package to color branches according
#   to the GC% values associated with each sequence.
#
# Inputs:
#   - ML tree file (Newick format)
#   - Metadata CSV file containing GC% values
#
# Outputs:
#   - A continuous trait map plot showing GC% variation.
############################################################


# Load required package
library(phytools)

# Define ML tree file
tree_file <- "U90.ML.treefile"

# Step 1: Read ML tree
# Tree generated by IQ-TREE (Newick format)
tree <- read.tree(tree_file)


# Step 2: Reroot tree on outgroup
# Outgroup should match a tip label in the tree
root.tree <- root(tree, outgroup = "HHV6A_outgroup_KP257584.1")

# Step 3: Read metadata (from metadata.csv file)
# Metadata file should contain TaxaName and GCpercent columns
meta <- read.csv("genbank_U90_metadata.csv", stringsAsFactors = FALSE)

# Make sure that GCpercent is numeric
meta$GCpercent <- as.numeric(meta$GCpercent)

# Step 4: Match metadata order to tree tip labels
tip_labels <- root.tree$tip.label
meta_ordered <- meta[match(tip_labels, meta$TaxaName), ]

# Step 5: Build numeric vector of GC% values
gc_vec <- meta_ordered$GCpercent
names(gc_vec) <- meta_ordered$TaxaName

# Step 6: Plot continuous trait mapping of GC%
cm <- contMap(root.tree, gc_vec, fsize = 0.9, plot = TRUE) #adjust label size as needed
